<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="orders.consultation.title">Consulta de Pedidos</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css" rel="stylesheet">
    <link href="https://cdn.datatables.net/buttons/2.4.2/css/buttons.bootstrap5.min.css" rel="stylesheet">
    <link href="https://cdn.datatables.net/responsive/2.5.0/css/responsive.bootstrap5.min.css" rel="stylesheet">
    <style>
        body {
            overflow-y: auto;
            margin: 0;
            padding: 20px;
            background-color: #F5F7FA;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #2C3E50;
        }

        .main-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(13, 75, 118, 0.1);
            padding: 30px;
            margin-bottom: 20px;
        }

        .page-header {
            background: linear-gradient(135deg, #0D4B76 0%, #1A6B9F 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 4px 15px rgba(13, 75, 118, 0.3);
        }

        .page-title {
            font-size: 2rem;
            font-weight: 600;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .page-subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            margin: 10px 0 0 0;
        }

        .filters-section {
            background: #F8F9FA;
            border: 2px solid #E9ECEF;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .filters-title {
            color: #0D4B76;
            font-weight: 600;
            font-size: 1.3rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-label {
            font-weight: 600;
            color: #0D4B76;
            margin-bottom: 8px;
        }

        .form-control, .form-select {
            border: 2px solid #E9ECEF;
            border-radius: 8px;
            padding: 12px 15px;
            font-size: 0.95rem;
            transition: all 0.3s ease;
        }

        .form-control:focus, .form-select:focus {
            border-color: #1A6B9F;
            box-shadow: 0 0 0 0.2rem rgba(26, 107, 159, 0.25);
        }

        .btn-primary {
            background: linear-gradient(135deg, #0D4B76 0%, #1A6B9F 100%);
            border: none;
            border-radius: 8px;
            padding: 12px 25px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(13, 75, 118, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(13, 75, 118, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #27AE60 0%, #2ECC71 100%);
            border: none;
            border-radius: 8px;
            padding: 12px 25px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-warning {
            background: linear-gradient(135deg, #F39C12 0%, #E67E22 100%);
            border: none;
            border-radius: 8px;
            padding: 12px 25px;
            font-weight: 600;
            color: white;
            transition: all 0.3s ease;
        }

        .btn-info {
            background: linear-gradient(135deg, #3498DB 0%, #2980B9 100%);
            border: none;
            border-radius: 8px;
            padding: 8px 15px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .results-section {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .results-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .results-title {
            color: #0D4B76;
            font-weight: 600;
            font-size: 1.4rem;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #0D4B76 0%, #1A6B9F 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(13, 75, 118, 0.3);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .table-container {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .table {
            margin: 0;
            font-size: 0.9rem;
        }

        .table thead th {
            background: linear-gradient(135deg, #0D4B76 0%, #1A6B9F 100%);
            color: white;
            border: none;
            padding: 15px 10px;
            font-weight: 600;
            text-align: center;
            vertical-align: middle;
        }

        .table tbody td {
            padding: 12px 10px;
            vertical-align: middle;
            border-bottom: 1px solid #E9ECEF;
            text-align: center;
        }

        .table tbody tr:hover {
            background-color: #F8F9FA;
        }

        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-completed {
            background: #D4EDDA;
            color: #155724;
        }

        .status-pending {
            background: #FFF3CD;
            color: #856404;
        }

        .status-partial {
            background: #CCE5FF;
            color: #004085;
        }

        .modal-header {
            background: linear-gradient(135deg, #0D4B76 0%, #1A6B9F 100%);
            color: white;
            border-bottom: none;
        }

        .modal-title {
            font-weight: 600;
        }

        .btn-close {
            filter: invert(1);
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #E9ECEF;
        }

        .detail-label {
            font-weight: 600;
            color: #0D4B76;
        }

        .detail-value {
            color: #2C3E50;
        }

        .loading-spinner {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .no-results {
            text-align: center;
            padding: 40px;
            color: #6C757D;
            display: none;
        }

        .export-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .progress-bar {
            background: linear-gradient(135deg, #0D4B76 0%, #1A6B9F 100%);
        }

        .alert-info {
            background: #CCE5FF;
            border-color: #1A6B9F;
            color: #004085;
        }

        @media (max-width: 768px) {
            .page-title {
                font-size: 1.5rem;
            }
            
            .results-header {
                flex-direction: column;
                align-items: stretch;
            }
            
            .export-buttons {
                justify-content: center;
            }
            
            .stats-cards {
                grid-template-columns: 1fr;
            }
        }

        .dataTables_wrapper .dataTables_length,
        .dataTables_wrapper .dataTables_filter,
        .dataTables_wrapper .dataTables_info,
        .dataTables_wrapper .dataTables_paginate {
            margin: 10px 0;
        }

        .dataTables_wrapper .dataTables_paginate .paginate_button {
            padding: 8px 12px;
            margin: 0 2px;
            border-radius: 6px;
            border: 1px solid #dee2e6;
            background: white;
            color: #0D4B76;
        }

        .dataTables_wrapper .dataTables_paginate .paginate_button:hover {
            background: #0D4B76;
            color: white;
            border-color: #0D4B76;
        }

        .dataTables_wrapper .dataTables_paginate .paginate_button.current {
            background: #0D4B76;
            color: white;
            border-color: #0D4B76;
        }
    </style>
</head>
<body>
    <div class="main-container">
        <!-- Header -->
        <div class="page-header">
            <h1 class="page-title" data-i18n="orders.consultation.title">
                <i class="fas fa-search"></i>
                Consulta de Pedidos
            </h1>
            <p class="page-subtitle" data-i18n="orders.consultation.subtitle">
                Consulte y analice todas las órdenes de pedido de compras con información detallada y filtros avanzados
            </p>
        </div>

        <!-- Filtros -->
        <div class="filters-section">
            <h3 class="filters-title" data-i18n="filters.title">
                <i class="fas fa-filter"></i>
                Filtros de Búsqueda
            </h3>
            
            <div class="row">
                <div class="col-md-3 mb-3">
                    <label class="form-label" data-i18n="filters.year">Año *</label>
                    <select class="form-select" id="yearFilter" required>
                        <option value="" data-i18n="filters.select_year">Seleccione un año</option>
                        <option value="2024" selected>2024</option>
                        <option value="2023">2023</option>
                        <option value="2022">2022</option>
                        <option value="2021">2021</option>
                        <option value="2020">2020</option>
                    </select>
                </div>
                
                <div class="col-md-3 mb-3">
                    <label class="form-label" data-i18n="filters.folio">Folio</label>
                    <input type="text" class="form-control" id="folioFilter" placeholder="Ej: PED-2024-001">
                </div>
                
                <div class="col-md-3 mb-3">
                    <label class="form-label" data-i18n="filters.supplier">Proveedor</label>
                    <select class="form-select" id="supplierFilter">
                        <option value="" data-i18n="filters.all_suppliers">Todos los proveedores</option>
                        <option value="PROV001">Distribuidora Industrial del Centro S.A. de C.V.</option>
                        <option value="PROV002">Suministros Técnicos Hidalgo S.A. de C.V.</option>
                        <option value="PROV003">Comercializadora de Equipos Gubernamentales</option>
                        <option value="PROV004">Papelería y Suministros Oficina Total</option>
                        <option value="PROV005">Constructora y Servicios Múltiples del Estado</option>
                    </select>
                </div>
                
                <div class="col-md-3 mb-3">
                    <label class="form-label" data-i18n="filters.budget_key">Clave Presupuestal</label>
                    <select class="form-select" id="budgetFilter">
                        <option value="" data-i18n="filters.all_budget_keys">Todas las claves</option>
                        <option value="2110">2110 - Materiales de Administración</option>
                        <option value="2120">2120 - Materiales y Artículos de Construcción</option>
                        <option value="2140">2140 - Materiales y Artículos Metálicos</option>
                        <option value="2150">2150 - Material Eléctrico y Electrónico</option>
                        <option value="2160">2160 - Material de Limpieza</option>
                        <option value="2170">2170 - Materiales y Útiles de Impresión</option>
                    </select>
                </div>
                
                <div class="col-md-3 mb-3">
                    <label class="form-label" data-i18n="filters.order_type">Tipo de Pedido</label>
                    <select class="form-select" id="typeFilter">
                        <option value="" data-i18n="filters.all_types">Todos los tipos</option>
                        <option value="NORMAL">Normal</option>
                        <option value="URGENTE">Urgente</option>
                        <option value="PROGRAMADO">Programado</option>
                        <option value="ESPECIAL">Especial</option>
                    </select>
                </div>
                
                <div class="col-md-3 mb-3">
                    <label class="form-label" data-i18n="filters.date_from">Fecha Desde</label>
                    <input type="date" class="form-control" id="dateFromFilter" value="2024-01-01">
                </div>
                
                <div class="col-md-3 mb-3">
                    <label class="form-label" data-i18n="filters.date_to">Fecha Hasta</label>
                    <input type="date" class="form-control" id="dateToFilter" value="2024-12-31">
                </div>
                
                <div class="col-md-3 mb-3">
                    <label class="form-label" data-i18n="filters.status">Estado</label>
                    <select class="form-select" id="statusFilter">
                        <option value="" data-i18n="filters.all_status">Todos los estados</option>
                        <option value="COMPLETO">Completo</option>
                        <option value="PENDIENTE">Pendiente</option>
                        <option value="PARCIAL">Parcial</option>
                    </select>
                </div>
            </div>
            
            <div class="row mt-3">
                <div class="col-12">
                    <div class="d-flex gap-3 flex-wrap">
                        <button type="button" class="btn btn-primary" onclick="searchOrders()">
                            <i class="fas fa-search"></i>
                            <span data-i18n="buttons.search">Buscar</span>
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="clearFilters()">
                            <i class="fas fa-eraser"></i>
                            <span data-i18n="buttons.clear">Limpiar Filtros</span>
                        </button>
                        <button type="button" class="btn btn-info" onclick="showAdvancedFilters()">
                            <i class="fas fa-cog"></i>
                            <span data-i18n="buttons.advanced_filters">Filtros Avanzados</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Estadísticas -->
        <div class="stats-cards" id="statsSection" style="display: none;">
            <div class="stat-card">
                <div class="stat-number" id="totalOrders">0</div>
                <div class="stat-label" data-i18n="stats.total_orders">Total de Pedidos</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalAmount">$0.00</div>
                <div class="stat-label" data-i18n="stats.total_amount">Monto Total</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="completedOrders">0</div>
                <div class="stat-label" data-i18n="stats.completed_orders">Pedidos Completos</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="pendingOrders">0</div>
                <div class="stat-label" data-i18n="stats.pending_orders">Pedidos Pendientes</div>
            </div>
        </div>

        <!-- Resultados -->
        <div class="results-section">
            <div class="results-header">
                <h3 class="results-title" data-i18n="results.title">
                    <i class="fas fa-table"></i>
                    Resultados de la Consulta
                </h3>
                <div class="export-buttons">
                    <button type="button" class="btn btn-success" onclick="exportToExcel()" id="exportBtn" disabled>
                        <i class="fas fa-file-excel"></i>
                        <span data-i18n="buttons.export_excel">Exportar a Excel</span>
                    </button>
                    <button type="button" class="btn btn-warning" onclick="exportToPDF()">
                        <i class="fas fa-file-pdf"></i>
                        <span data-i18n="buttons.export_pdf">Exportar a PDF</span>
                    </button>
                    <button type="button" class="btn btn-info" onclick="printReport()">
                        <i class="fas fa-print"></i>
                        <span data-i18n="buttons.print">Imprimir</span>
                    </button>
                </div>
            </div>

            <!-- Loading -->
            <div class="loading-spinner" id="loadingSpinner">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden" data-i18n="loading">Cargando...</span>
                </div>
                <p class="mt-3" data-i18n="loading.searching">Buscando pedidos...</p>
            </div>

            <!-- No Results -->
            <div class="no-results" id="noResults">
                <i class="fas fa-search fa-3x text-muted mb-3"></i>
                <h4 data-i18n="no_results.title">No se encontraron resultados</h4>
                <p data-i18n="no_results.message">Intente modificar los filtros de búsqueda para obtener resultados.</p>
            </div>

            <!-- Tabla de Resultados -->
            <div class="table-container" id="resultsTable" style="display: none;">
                <table class="table table-striped table-hover" id="ordersTable">
                    <thead>
                        <tr>
                            <th data-i18n="table.folio">Folio</th>
                            <th data-i18n="table.item">Partida</th>
                            <th data-i18n="table.order_date">Fecha Pedido</th>
                            <th data-i18n="table.type">Tipo</th>
                            <th data-i18n="table.initials">Iniciales</th>
                            <th data-i18n="table.supplier">Proveedor</th>
                            <th data-i18n="table.rfc">R.F.C</th>
                            <th data-i18n="table.budget_key">Clave Presupuestal</th>
                            <th data-i18n="table.item_name">Nombre de Partida</th>
                            <th data-i18n="table.quantity">Cantidad</th>
                            <th data-i18n="table.supplied_quantity">Cantidad Surtida</th>
                            <th data-i18n="table.price">Precio</th>
                            <th data-i18n="table.unit">Unidad</th>
                            <th data-i18n="table.observations">Observaciones</th>
                            <th data-i18n="table.description">Descripción</th>
                            <th data-i18n="table.actions">Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="ordersTableBody">
                        <tr>
                           <td>PED-2024-001</td>
                           <td>001</td>
                           <td>15/01/2024</td>
                           <td><span class="badge bg-secondary">NORMAL</span></td>
                           <td>JGH</td>
                           <td>Distribuidora Industrial del Centro S.A. de C.V.</td>
                           <td>DIC850315ABC</td>
                           <td>2110</td>
                           <td>Materiales de Administración, Emisión de Documentos y Artículos Oficiales</td>
                           <td>50</td>
                           <td>50</td>
                           <td>$125.50</td>
                           <td>PZA</td>
                           <td>Entrega completa en tiempo</td>
                           <td>Papel bond tamaño carta 75gr, resma de 500 hojas</td>
                           <td>
                               <button class="btn btn-info btn-sm" onclick="showOrderDetail(0)" title="Ver Detalle">
                                   <i class="fas fa-eye"></i>
                               </button>
                           </td>
                       </tr>
                       <tr>
                           <td>PED-2024-002</td>
                           <td>002</td>
                           <td>18/01/2024</td>
                           <td><span class="badge bg-secondary">URGENTE</span></td>
                           <td>MRL</td>
                           <td>Suministros Técnicos Hidalgo S.A. de C.V.</td>
                           <td>STH920428DEF</td>
                           <td>2150</td>
                           <td>Material Eléctrico y Electrónico</td>
                           <td>25</td>
                           <td>20</td>
                           <td>$850.00</td>
                           <td>PZA</td>
                           <td>Pendiente entrega de 5 unidades</td>
                           <td>Computadora de escritorio Core i5, 8GB RAM, 1TB HDD</td>
                           <td>
                               <button class="btn btn-info btn-sm" onclick="showOrderDetail(1)" title="Ver Detalle">
                                   <i class="fas fa-eye"></i>
                               </button>
                           </td>
                       </tr>
                       <tr>
                           <td>PED-2024-003</td>
                           <td>003</td>
                           <td>22/01/2024</td>
                           <td><span class="badge bg-secondary">PROGRAMADO</span></td>
                           <td>CAM</td>
                           <td>Comercializadora de Equipos Gubernamentales</td>
                           <td>CEG780912GHI</td>
                           <td>2120</td>
                           <td>Materiales y Artículos de Construcción y de Reparación</td>
                           <td>100</td>
                           <td>0</td>
                           <td>$45.75</td>
                           <td>M2</td>
                           <td>En proceso de fabricación</td>
                           <td>Pintura vinílica blanca para interiores, cubeta de 19 litros</td>
                           <td>
                               <button class="btn btn-info btn-sm" onclick="showOrderDetail(2)" title="Ver Detalle">
                                   <i class="fas fa-eye"></i>
                               </button>
                           </td>
                       </tr>
                    </tbody>
                </table>
            </div>

            <!-- Información inicial -->
            <div class="alert alert-info" id="initialMessage">
                <i class="fas fa-info-circle"></i>
                <span data-i18n="initial.message">Seleccione un año y haga clic en "Buscar" para consultar los pedidos.</span>
            </div>
        </div>
    </div>

    <!-- Modal de Detalle de Pedido -->
    <div class="modal fade" id="orderDetailModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" data-i18n="modal.order_detail.title">Detalle del Pedido</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6 class="text-primary mb-3" data-i18n="modal.general_info">Información General</h6>
                            <div class="detail-row">
                                <span class="detail-label" data-i18n="modal.folio">Folio:</span>
                                <span class="detail-value" id="modalFolio">-</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label" data-i18n="modal.date">Fecha:</span>
                                <span class="detail-value" id="modalDate">-</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label" data-i18n="modal.type">Tipo:</span>
                                <span class="detail-value" id="modalType">-</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label" data-i18n="modal.initials">Iniciales:</span>
                                <span class="detail-value" id="modalInitials">-</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label" data-i18n="modal.status">Estado:</span>
                                <span class="detail-value" id="modalStatus">-</span>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <h6 class="text-primary mb-3" data-i18n="modal.supplier_info">Información del Proveedor</h6>
                            <div class="detail-row">
                                <span class="detail-label" data-i18n="modal.supplier">Proveedor:</span>
                                <span class="detail-value" id="modalSupplier">-</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label" data-i18n="modal.rfc">R.F.C:</span>
                                <span class="detail-value" id="modalRFC">-</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label" data-i18n="modal.contact">Contacto:</span>
                                <span class="detail-value" id="modalContact">-</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label" data-i18n="modal.phone">Teléfono:</span>
                                <span class="detail-value" id="modalPhone">-</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label" data-i18n="modal.email">Email:</span>
                                <span class="detail-value" id="modalEmail">-</span>
                            </div>
                        </div>
                    </div>
                    
                    <hr class="my-4">
                    
                    <div class="row">
                        <div class="col-12">
                            <h6 class="text-primary mb-3" data-i18n="modal.budget_info">Información Presupuestal</h6>
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="detail-row">
                                        <span class="detail-label" data-i18n="modal.budget_key">Clave Presupuestal:</span>
                                        <span class="detail-value" id="modalBudgetKey">-</span>
                                    </div>
                                </div>
                                <div class="col-md-8">
                                    <div class="detail-row">
                                        <span class="detail-label" data-i18n="modal.item_name">Nombre de Partida:</span>
                                        <span class="detail-value" id="modalItemName">-</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <hr class="my-4">
                    
                    <div class="row">
                        <div class="col-md-3">
                            <div class="detail-row">
                                <span class="detail-label" data-i18n="modal.quantity">Cantidad:</span>
                                <span class="detail-value" id="modalQuantity">-</span>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="detail-row">
                                <span class="detail-label" data-i18n="modal.supplied">Cantidad Surtida:</span>
                                <span class="detail-value" id="modalSupplied">-</span>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="detail-row">
                                <span class="detail-label" data-i18n="modal.unit_price">Precio Unitario:</span>
                                <span class="detail-value" id="modalPrice">-</span>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="detail-row">
                                <span class="detail-label" data-i18n="modal.unit">Unidad:</span>
                                <span class="detail-value" id="modalUnit">-</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row mt-3">
                        <div class="col-md-6">
                            <div class="detail-row">
                                <span class="detail-label" data-i18n="modal.subtotal">Subtotal:</span>
                                <span class="detail-value" id="modalSubtotal">-</span>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="detail-row">
                                <span class="detail-label" data-i18n="modal.total">Total:</span>
                                <span class="detail-value fw-bold" id="modalTotal">-</span>
                            </div>
                        </div>
                    </div>
                    
                    <hr class="my-4">
                    
                    <div class="row">
                        <div class="col-12">
                            <h6 class="text-primary mb-3" data-i18n="modal.additional_info">Información Adicional</h6>
                            <div class="detail-row">
                                <span class="detail-label" data-i18n="modal.description">Descripción:</span>
                                <span class="detail-value" id="modalDescription">-</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label" data-i18n="modal.observations">Observaciones:</span>
                                <span class="detail-value" id="modalObservations">-</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-i18n="buttons.close">Cerrar</button>
                    <button type="button" class="btn btn-primary" onclick="printOrderDetail()" data-i18n="buttons.print_detail">Imprimir Detalle</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Filtros Avanzados -->
    <div class="modal fade" id="advancedFiltersModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" data-i18n="modal.advanced_filters.title">Filtros Avanzados</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label" data-i18n="advanced.amount_from">Monto Desde</label>
                            <input type="number" class="form-control" id="amountFromFilter" step="0.01" min="0">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label" data-i18n="advanced.amount_to">Monto Hasta</label>
                            <input type="number" class="form-control" id="amountToFilter" step="0.01" min="0">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label" data-i18n="advanced.responsible">Responsable (Iniciales)</label>
                            <select class="form-select" id="responsibleFilter">
                                <option value="" data-i18n="advanced.all_responsible">Todos los responsables</option>
                                <option value="JGH">JGH - Juan García Hernández</option>
                                <option value="MRL">MRL - María Rodríguez López</option>
                                <option value="CAM">CAM - Carlos Álvarez Martínez</option>
                                <option value="LPV">LPV - Laura Pérez Vázquez</option>
                                <option value="RMC">RMC - Roberto Morales Castro</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label" data-i18n="advanced.department">Departamento</label>
                            <select class="form-select" id="departmentFilter">
                                <option value="" data-i18n="advanced.all_departments">Todos los departamentos</option>
                                <option value="ADMIN">Administración</option>
                                <option value="OBRAS">Obras Públicas</option>
                                <option value="SALUD">Salud</option>
                                <option value="EDUCACION">Educación</option>
                                <option value="SEGURIDAD">Seguridad Pública</option>
                            </select>
                        </div>
                        <div class="col-md-12 mb-3">
                            <label class="form-label" data-i18n="advanced.keywords">Palabras Clave en Descripción</label>
                            <input type="text" class="form-control" id="keywordsFilter" placeholder="Ej: computadora, papel, construcción">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label" data-i18n="advanced.priority">Prioridad</label>
                            <select class="form-select" id="priorityFilter">
                                <option value="" data-i18n="advanced.all_priorities">Todas las prioridades</option>
                                <option value="ALTA">Alta</option>
                                <option value="MEDIA">Media</option>
                                <option value="BAJA">Baja</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label" data-i18n="advanced.delivery_status">Estado de Entrega</label>
                            <select class="form-select" id="deliveryStatusFilter">
                                <option value="" data-i18n="advanced.all_delivery_status">Todos los estados</option>
                                <option value="ENTREGADO">Entregado</option>
                                <option value="EN_TRANSITO">En Tránsito</option>
                                <option value="PENDIENTE_ENTREGA">Pendiente de Entrega</option>
                                <option value="RETRASADO">Retrasado</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-i18n="buttons.cancel">Cancelar</button>
                    <button type="button" class="btn btn-warning" onclick="clearAdvancedFilters()" data-i18n="buttons.clear_advanced">Limpiar Filtros</button>
                    <button type="button" class="btn btn-primary" onclick="applyAdvancedFilters()" data-i18n="buttons.apply_filters">Aplicar Filtros</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.2/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.bootstrap5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.html5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.print.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.5.0/js/dataTables.responsive.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.5.0/js/responsive.bootstrap5.min.js"></script>

   <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Datos de ejemplo para simular la funcionalidad
        const sampleOrders = [
            {
                folio: "PED-2024-001",
                partida: "001",
                fechaPedido: "2024-01-15",
                tipo: "NORMAL",
                iniciales: "JGH",
                proveedor: "Distribuidora Industrial del Centro S.A. de C.V.",
                rfc: "DIC850315ABC",
                clavePresupuestal: "2110",
                nombrePartida: "Materiales de Administración, Emisión de Documentos y Artículos Oficiales",
                cantidad: 50,
                cantidadSurtida: 50,
                precio: 125.50,
                unidad: "PZA",
                observaciones: "Entrega completa en tiempo",
                descripcion: "Papel bond tamaño carta 75gr, resma de 500 hojas",
                estado: "COMPLETO",
                contacto: "Ing. Roberto Sánchez",
                telefono: "771-123-4567",
                email: "ventas@dic.com.mx"
            },
            {
                folio: "PED-2024-002",
                partida: "002",
                fechaPedido: "2024-01-18",
                tipo: "URGENTE",
                iniciales: "MRL",
                proveedor: "Suministros Técnicos Hidalgo S.A. de C.V.",
                rfc: "STH920428DEF",
                clavePresupuestal: "2150",
                nombrePartida: "Material Eléctrico y Electrónico",
                cantidad: 25,
                cantidadSurtida: 20,
                precio: 850.00,
                unidad: "PZA",
                observaciones: "Pendiente entrega de 5 unidades",
                descripcion: "Computadora de escritorio Core i5, 8GB RAM, 1TB HDD",
                estado: "PARCIAL",
                contacto: "Lic. Ana María Torres",
                telefono: "771-234-5678",
                email: "compras@sth.com.mx"
            },
            {
                folio: "PED-2024-003",
                partida: "003",
                fechaPedido: "2024-01-22",
                tipo: "PROGRAMADO",
                iniciales: "CAM",
                proveedor: "Comercializadora de Equipos Gubernamentales",
                rfc: "CEG780912GHI",
                clavePresupuestal: "2120",
                nombrePartida: "Materiales y Artículos de Construcción y de Reparación",
                cantidad: 100,
                cantidadSurtida: 0,
                precio: 45.75,
                unidad: "M2",
                observaciones: "En proceso de fabricación",
                descripcion: "Pintura vinílica blanca para interiores, cubeta de 19 litros",
                estado: "PENDIENTE",
                contacto: "Arq. Fernando López",
                telefono: "771-345-6789",
                email: "proyectos@ceg.gob.mx"
            },
            {
                folio: "PED-2024-004",
                partida: "004",
                fechaPedido: "2024-02-05",
                tipo: "NORMAL",
                iniciales: "LPV",
                proveedor: "Papelería y Suministros Oficina Total",
                rfc: "PSO650203JKL",
                clavePresupuestal: "2170",
                nombrePartida: "Materiales y Útiles de Impresión y Reproducción",
                cantidad: 200,
                cantidadSurtida: 200,
                precio: 15.25,
                unidad: "PZA",
                observaciones: "Entrega satisfactoria",
                descripcion: "Tóner para impresora láser HP LaserJet Pro M404dn",
                estado: "COMPLETO",
                contacto: "Sr. Miguel Hernández",
                telefono: "771-456-7890",
                email: "ventas@psot.com"
            },
            {
                folio: "PED-2024-005",
                partida: "005",
                fechaPedido: "2024-02-12",
                tipo: "ESPECIAL",
                iniciales: "RMC",
                proveedor: "Constructora y Servicios Múltiples del Estado",
                rfc: "CSM890715MNO",
                clavePresupuestal: "2140",
                nombrePartida: "Materiales y Artículos Metálicos",
                cantidad: 75,
                cantidadSurtida: 75,
                precio: 320.80,
                unidad: "KG",
                observaciones: "Material certificado entregado",
                descripcion: "Varilla corrugada #4 de 12 metros para construcción",
                estado: "COMPLETO",
                contacto: "Ing. Patricia Ruiz",
                telefono: "771-567-8901",
                email: "construccion@csme.gob.mx"
            },
            {
                folio: "PED-2024-006",
                partida: "006",
                fechaPedido: "2024-02-20",
                tipo: "NORMAL",
                iniciales: "JGH",
                proveedor: "Distribuidora Industrial del Centro S.A. de C.V.",
                rfc: "DIC850315ABC",
                clavePresupuestal: "2160",
                nombrePartida: "Material de Limpieza",
                cantidad: 150,
                cantidadSurtida: 120,
                precio: 28.90,
                unidad: "LT",
                observaciones: "Falta surtir 30 litros",
                descripcion: "Detergente líquido biodegradable para limpieza general",
                estado: "PARCIAL",
                contacto: "Ing. Roberto Sánchez",
                telefono: "771-123-4567",
                email: "ventas@dic.com.mx"
            },
            {
                folio: "PED-2024-007",
                partida: "007",
                fechaPedido: "2024-03-01",
                tipo: "URGENTE",
                iniciales: "MRL",
                proveedor: "Suministros Técnicos Hidalgo S.A. de C.V.",
                rfc: "STH920428DEF",
                clavePresupuestal: "2110",
                nombrePartida: "Materiales de Administración, Emisión de Documentos y Artículos Oficiales",
                cantidad: 80,
                cantidadSurtida: 0,
                precio: 95.60,
                unidad: "PZA",
                observaciones: "Pedido en proceso de autorización",
                descripcion: "Archivero metálico de 4 gavetas con cerradura",
                estado: "PENDIENTE",
                contacto: "Lic. Ana María Torres",
                telefono: "771-234-5678",
                email: "compras@sth.com.mx"
            },
            {
                folio: "PED-2024-008",
                partida: "008",
                fechaPedido: "2024-03-08",
                tipo: "PROGRAMADO",
                iniciales: "CAM",
                proveedor: "Comercializadora de Equipos Gubernamentales",
                rfc: "CEG780912GHI",
                clavePresupuestal: "2150",
                nombrePartida: "Material Eléctrico y Electrónico",
                cantidad: 30,
                cantidadSurtida: 30,
                precio: 1250.00,
                unidad: "PZA",
                observaciones: "Instalación incluida completada",
                descripcion: "Proyector multimedia 3500 lúmenes con accesorios",
                estado: "COMPLETO",
                contacto: "Arq. Fernando López",
                telefono: "771-345-6789",
                email: "proyectos@ceg.gob.mx"
            }
        ];

        let dataTable;
        let filteredOrders = [];

        // Función para buscar pedidos
        function searchOrders() {
            const year = document.getElementById('yearFilter').value;
            
            if (!year) {
                alert('Por favor seleccione un año para realizar la búsqueda.');
                return;
            }

            // Mostrar loading
            document.getElementById('loadingSpinner').style.display = 'block';
            document.getElementById('resultsTable').style.display = 'none';
            document.getElementById('noResults').style.display = 'none';
            document.getElementById('initialMessage').style.display = 'none';
            document.getElementById('statsSection').style.display = 'none';

            // Simular delay de búsqueda
            setTimeout(() => {
                // Aplicar filtros
                filteredOrders = sampleOrders.filter(order => {
                    const orderYear = new Date(order.fechaPedido).getFullYear().toString();
                    if (orderYear !== year) return false;

                    const folio = document.getElementById('folioFilter').value;
                    if (folio && !order.folio.toLowerCase().includes(folio.toLowerCase())) return false;

                    const supplier = document.getElementById('supplierFilter').value;
                    if (supplier && !order.proveedor.includes(supplier)) return false;

                    const budget = document.getElementById('budgetFilter').value;
                    if (budget && order.clavePresupuestal !== budget) return false;

                    const type = document.getElementById('typeFilter').value;
                    if (type && order.tipo !== type) return false;

                    const status = document.getElementById('statusFilter').value;
                    if (status && order.estado !== status) return false;

                    const dateFrom = document.getElementById('dateFromFilter').value;
                    if (dateFrom && order.fechaPedido < dateFrom) return false;

                    const dateTo = document.getElementById('dateToFilter').value;
                    if (dateTo && order.fechaPedido > dateTo) return false;

                    return true;
                });

                // Ocultar loading
                document.getElementById('loadingSpinner').style.display = 'none';

                if (filteredOrders.length === 0) {
                    document.getElementById('noResults').style.display = 'block';
                } else {
                    displayResults();
                    updateStats();
                    document.getElementById('resultsTable').style.display = 'block';
                    document.getElementById('statsSection').style.display = 'grid';
                    document.getElementById('exportBtn').disabled = false;
                }
            }, 1500);
        }

        // Función para mostrar resultados
        function displayResults() {
            const tbody = document.getElementById('ordersTableBody');
            tbody.innerHTML = '';

            filteredOrders.forEach((order, index) => {
                const statusClass = order.estado === 'COMPLETO' ? 'status-completed' : 
                                  order.estado === 'PENDIENTE' ? 'status-pending' : 'status-partial';
                
                const total = (order.cantidad * order.precio).toFixed(2);
                
                const row = `
                    <tr>
                        <td>${order.folio}</td>
                        <td>${order.partida}</td>
                        <td>${formatDate(order.fechaPedido)}</td>
                        <td><span class="badge bg-secondary">${order.tipo}</span></td>
                        <td>${order.iniciales}</td>
                        <td>${order.proveedor}</td>
                        <td>${order.rfc}</td>
                        <td>${order.clavePresupuestal}</td>
                        <td>${order.nombrePartida}</td>
                        <td>${order.cantidad.toLocaleString()}</td>
                        <td>${order.cantidadSurtida.toLocaleString()}</td>
                        <td>$${order.precio.toLocaleString('es-MX', {minimumFractionDigits: 2})}</td>
                        <td>${order.unidad}</td>
                        <td>${order.observaciones}</td>
                        <td>${order.descripcion}</td>
                        <td>
                            <button class="btn btn-info btn-sm" onclick="showOrderDetail(${index})" title="Ver Detalle">
                                <i class="fas fa-eye"></i>
                            </button>
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });

            // Inicializar DataTable si no existe
            if (dataTable) {
                dataTable.destroy();
            }

            dataTable = $('#ordersTable').DataTable({
                responsive: true,
                language: {
                    url: '//cdn.datatables.net/plug-ins/1.13.6/i18n/es-ES.json'
                },
                dom: 'Bfrtip',
                buttons: [
                    {
                        extend: 'excel',
                        text: '<i class="fas fa-file-excel"></i> Excel',
                        className: 'btn btn-success btn-sm',
                        filename: `Pedidos_${new Date().getFullYear()}_${new Date().getMonth() + 1}_${new Date().getDate()}`
                    },
                    {
                        extend: 'pdf',
                        text: '<i class="fas fa-file-pdf"></i> PDF',
                        className: 'btn btn-danger btn-sm',
                        filename: `Pedidos_${new Date().getFullYear()}_${new Date().getMonth() + 1}_${new Date().getDate()}`,
                        orientation: 'landscape',
                        pageSize: 'A4'
                    },
                    {
                        extend: 'print',
                        text: '<i class="fas fa-print"></i> Imprimir',
                        className: 'btn btn-secondary btn-sm'
                    }
                ],
                pageLength: 25,
                order: [[2, 'desc']], // Ordenar por fecha descendente
                columnDefs: [
                    { targets: [15], orderable: false } // Columna de acciones no ordenable
                ]
            });
        }

        // Función para actualizar estadísticas
        function updateStats() {
            const totalOrders = filteredOrders.length;
            const completedOrders = filteredOrders.filter(o => o.estado === 'COMPLETO').length;
            const pendingOrders = filteredOrders.filter(o => o.estado === 'PENDIENTE').length;
            const totalAmount = filteredOrders.reduce((sum, order) => sum + (order.cantidad * order.precio), 0);

            document.getElementById('totalOrders').textContent = totalOrders.toLocaleString();
            document.getElementById('totalAmount').textContent = '$' + totalAmount.toLocaleString('es-MX', {minimumFractionDigits: 2});
            document.getElementById('completedOrders').textContent = completedOrders.toLocaleString();
            document.getElementById('pendingOrders').textContent = pendingOrders.toLocaleString();
        }

        // Función para mostrar detalle del pedido
        function showOrderDetail(index) {
            const order = filteredOrders[index];
            
            document.getElementById('modalFolio').textContent = order.folio;
            document.getElementById('modalDate').textContent = formatDate(order.fechaPedido);
            document.getElementById('modalType').textContent = order.tipo;
            document.getElementById('modalInitials').textContent = order.iniciales;
            document.getElementById('modalStatus').textContent = order.estado;
            document.getElementById('modalSupplier').textContent = order.proveedor;
            document.getElementById('modalRFC').textContent = order.rfc;
            document.getElementById('modalContact').textContent = order.contacto;
            document.getElementById('modalPhone').textContent = order.telefono;
            document.getElementById('modalEmail').textContent = order.email;
            document.getElementById('modalBudgetKey').textContent = order.clavePresupuestal;
            document.getElementById('modalItemName').textContent = order.nombrePartida;
            document.getElementById('modalQuantity').textContent = order.cantidad.toLocaleString() + ' ' + order.unidad;
            document.getElementById('modalSupplied').textContent = order.cantidadSurtida.toLocaleString() + ' ' + order.unidad;
            document.getElementById('modalPrice').textContent = '$' + order.precio.toLocaleString('es-MX', {minimumFractionDigits: 2});
            document.getElementById('modalUnit').textContent = order.unidad;
            
            const subtotal = order.cantidad * order.precio;
            const iva = subtotal * 0.16;
            const total = subtotal + iva;
            
            document.getElementById('modalSubtotal').textContent = '$' + subtotal.toLocaleString('es-MX', {minimumFractionDigits: 2});
            document.getElementById('modalTotal').textContent = '$' + total.toLocaleString('es-MX', {minimumFractionDigits: 2});
            document.getElementById('modalDescription').textContent = order.descripcion;
            document.getElementById('modalObservations').textContent = order.observaciones;

            const modal = new bootstrap.Modal(document.getElementById('orderDetailModal'));
            modal.show();
        }

        // Función para limpiar filtros
        function clearFilters() {
            document.getElementById('folioFilter').value = '';
            document.getElementById('supplierFilter').value = '';
            document.getElementById('budgetFilter').value = '';
            document.getElementById('typeFilter').value = '';
            document.getElementById('statusFilter').value = '';
            document.getElementById('dateFromFilter').value = '2024-01-01';
            document.getElementById('dateToFilter').value = '2024-12-31';
        }

        // Función para mostrar filtros avanzados
        function showAdvancedFilters() {
            const modal = new bootstrap.Modal(document.getElementById('advancedFiltersModal'));
            modal.show();
        }

        // Función para limpiar filtros avanzados
        function clearAdvancedFilters() {
            document.getElementById('amountFromFilter').value = '';
            document.getElementById('amountToFilter').value = '';
            document.getElementById('responsibleFilter').value = '';
            document.getElementById('departmentFilter').value = '';
            document.getElementById('keywordsFilter').value = '';
            document.getElementById('priorityFilter').value = '';
            document.getElementById('deliveryStatusFilter').value = '';
        }

        // Función para aplicar filtros avanzados
        function applyAdvancedFilters() {
            // Aquí se implementaría la lógica de filtros avanzados
            alert('Filtros avanzados aplicados correctamente.');
            const modal = bootstrap.Modal.getInstance(document.getElementById('advancedFiltersModal'));
            modal.hide();
        }

        // Función para exportar a Excel
        function exportToExcel() {
            if (dataTable) {
                dataTable.button('.buttons-excel').trigger();
            }
        }

        // Función para exportar a PDF
        function exportToPDF() {
            if (dataTable) {
                dataTable.button('.buttons-pdf').trigger();
            }
        }

        // Función para imprimir reporte
        function printReport() {
            if (dataTable) {
                dataTable.button('.buttons-print').trigger();
            }
        }

        // Función para imprimir detalle del pedido
        function printOrderDetail() {
            window.print();
        }

        // Función para formatear fecha
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('es-MX', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit'
            });
        }

        // Inicialización
        document.addEventListener('DOMContentLoaded', function() {
            // Configurar fechas por defecto
            const currentYear = new Date().getFullYear();
            document.getElementById('dateFromFilter').value = `${currentYear}-01-01`;
            document.getElementById('dateToFilter').value = `${currentYear}-12-31`;
        });

       // Inicializar los charts al cargar la página
       initializeCharts();
    </script>
    <script src="Resources_.js"></script>
</body>
</html>